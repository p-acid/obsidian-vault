---
tags:
  - React
  - Memoizing
---
# Trigger

- 평소 작업을 할 때 `useMemo` 혹은 `useCallback` 을 언제 활용하는 것이 적절한 사용인지 고민을 하게 되어 사용하는 것을 꺼리게 된다.
- 그래서 어떨때 활용하는 것이 가장 적절할 지 궁금했다.

# Contents

## 값을 메모이징 하기 위한 React Hook은 어떤 원리로 동작하는가?

- 리액트는 메모이제이션(Memoization)을 위해 `useMemo` 와 `useCallback` 등을 제공한다.
- `useMemo` 는 계산된 값을, `useCallback` 은 함수를 메모하는데 사용하며 의존성 배열의 값들이 변화하지 않는다면 메모이징 된 값들을 반환합니다.
- 내부적으로는 메모이징 하기 위해 **JavaScript 클로저**에 의존합니다. 의존성 값이 변경되면 메모된 값이나 함수를 무효화하고 다시 계산하기에 불필요한 계산을 최소화하는 동시에 최신 결과를 얻을 수 있습니다.
- 과도한 메모는 **메모리 사용량 증가**로 이어질 수 있으므로 이러한 훅을 신중하게 사용하는 것이 중요합니다. 특정 사용 사례에 따라 계산 시간과 메모리 사용량 간의 균형을 고려해야 합니다.

## React에서 메모이징을 하기 위한 방법은 무엇이 있는가?

- `Memo` 혹은 `useMemo`, `useCallback` 훅 등을 통해 가능하다
- 커스텀 메모 함수를 만들 수도 있다.

```tsx
const memoizedFunction = (function() {
  const cache = new Map();
  return (key) => {
    if (cache.has(key)) {
      return cache.get(key);
    }
    const result = expensiveCalculation(key);
    cache.set(key, result);
    return result;
  };
})();
```

## 어떻게 메모이징 하면 비효율이 발생하는가?

다음의 시나리오에서 발생할 수 있다.

1. **과도한 메모:** 실제로 **메모할 필요가 없는 값이나 기능**을 너무 많이 메모하면 상당한 성능 이점을 제공하지 못한 채 메모리 사용량과 복잡성이 증가할 수 있습니다. 메모를 과도하게 하면 메모된 값을 캡처하고 저장하는 데 필요한 추가 작업으로 인해 메모리 소비가 늘어나고 초기 렌더링 시간이 느려질 수 있습니다.
2. **불필요한 메모:** 자주 변경되지 않거나 렌더링에 큰 영향을 주지 않는 값을 메모하면 불필요한 오버 헤드가 추가될 수 있습니다. 렌더링 최적화에 직접적인 영향을 미치는 값을 메모하는 데 집중하는 것이 중요합니다.
3. **빠른 작업으로 메모 기능 사용:** 메모는 성능에 큰 영향을 미치는 값비싼 계산이나 함수와 함께 사용할 때 가장 효과적입니다. 이미 빠른 기능에 메모를 적용해도 눈에 띄는 개선이 이루어지지 않을 수 있으며 메모 메커니즘 자체로 인해 추가 오버 헤드가 발생할 수도 있습니다.
4. **메모 기능을 잘못 사용하는 경우:** `useMemo` 또는 `useCallback` 에서 종속성 배열을 잘못 사용하면 예상치 못한 결과가 발생할 수 있습니다. 있어야 하는 의존성을 생략하면 해당 의존성이 변경될 때 메모된 값이나 함수가 올바르게 업데이트 되지 않을 수 있습니다. 반대로, 실제로 출력에 영향을 주지 않는 의존성을 포함하면 불필요한 재계산이 발생할 수 있습니다.
5. **단기 가치 메모하기:** 메모된 값의 수명이 매우 짧고 단일 렌더링 주기 내에서만 사용되는 경우 의존성을 캡처하고 확인하는 오버 헤드가 메모의 이점보다 클 수 있습니다.
6. **조기 최적화:** 성능 문제에 대한 명확한 증거 없이 메모이제이션을 적용하면 코드가 복잡해지고 유지 관리가 더 어려워질 수 있습니다. 일반적으로 먼저 명확성을 위해 최적화가 필요한 경우 성능을 위해 최적화하는 것이 가장 좋습니다.

### 메모이제이션 유의점

- 메모이제이션은 메모리 사용량과 계산 시간 사이의 절충안이라는 점을 기억하세요.
- 가장 좋은 방법은 병목 현상이나 성능 개선이 필요한 영역을 식별한 다음 해당 특정 영역에 메모를 적용하는 것부터 시작하는 것입니다.

# Summary

- React에서 값을 메모이징 하기 위한 방법인 `useMemo` 와 `useCallback` 은 자바스크립트 클로저 기반으로 동작한다.
- 초기렌더링 단계에서 클로저에 메모이징 할 값 또는 함수와 의존성 배열의 값을 저장하고, 리 렌더링이 발생할 때마다 클로저의 의존성 값과 업데이트 된 의존성 값을 비교하여 메모이징 된 값을 업데이트 한다.
- 메모이징 처리가 불필요한 값으로는 기본 값, 단일 렌더링에 활용되는 값, 잦은 변경 값 등이 이에 해당하고 함수의 경우 기본적인 산술 연산, 문자열 조작, Boolean 값 검사 등이 이에 해당한다.
- 과도하고 불필요한 메모는 오히려 독이 되어 비효율을 발생시킬 수 있으며, 잘못 사용한 메모이징 방식 또한 비효율을 초래할 수 있다.
- 조기에 최적화를 위한 메모이징 적용을 진행하기 보다는, 최적화가 필요한 경우 성능 개선을 위해 정확한 포인트에 메모이징 적용을 하는 것이 좋다.